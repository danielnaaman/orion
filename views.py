from . import app
from models.crons import create_LocalDatabaseServiceRoutines
from models.forms import LoginFormStructure
from models.forms import RegisterFormStructure
from models.forms import QueryFormStructure
from datetime import datetime
from flask import render_template, redirect, flash, request
from os import path
import matplotlib.pyplot as plt
from matplotlib.backends.backend_agg import FigureCanvasAgg as FigureCanvas
import pandas as pd
import base64
import io

app.config['SECRET_KEY'] = 'N/A'
db_Functions = create_LocalDatabaseServiceRoutines() 

# General


@app.route('/')
def home():
    return render_template(
        'home.html',
        title='Home',
        year=datetime.now().year
    )


@app.route('/about')
def about():
    return render_template(
        'about.html',
        title='About',
        year=datetime.now().year
    )


@app.route('/contact')
def contact():
    return render_template(
        'contact.html',
        title='Contact',
        year=datetime.now().year
    )

# Datasets


@app.route('/datasets')
def datasets():
    return render_template(
        'datasets.html',
        title='Data Sets',
        year=datetime.now().year
    )


@app.route('/datasets/avocado_prices')
def avocado_prices():
    avocadoprices = pd.read_csv(path.join(path.dirname(__file__), 'static/data/avocado_prices.csv'))
    avocadoprices = avocadoprices.drop(columns="Volume")
    avocadoprices['Date'] = pd.to_datetime(avocadoprices['Date'])
    avocadoprices = avocadoprices.sample(10)
    avocadoprices = avocadoprices.set_index("Date")
    avocado_prices_preview = avocadoprices.to_html(classes ='table table-hover')
    return render_template(
        'avocado_prices.html',
        avocado_prices_preview=avocado_prices_preview,
        title='Avocado Prices ' + '(Data Set)',
        year=datetime.now().year
    )


@app.route('/datasets/average_weather')
def average_weather():
    averageweather = pd.read_csv(path.join(path.dirname(__file__), 'static/data/average_weather.csv'))
    averageweather['Date'] = pd.to_datetime(averageweather['Date'])
    averageweather = averageweather.sample(10)
    averageweather = averageweather.set_index("Date")
    average_weather_preview = averageweather.to_html(classes='table table-hover')
    return render_template(
        'average_weather.html',
        average_weather_preview=average_weather_preview,
        title='Average Weather ' + '(Data Set)',
        year=datetime.now().year
    )


@app.route('/query' , methods = ['GET' , 'POST'])
def query():
    form = QueryFormStructure(startDate = pd.Timestamp("2015-04-01"), endDate = pd.Timestamp("2015-05-31"))
    chart = "data:image/png;base64,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OnSo07+nd+/emjRpUq59YmJiZLFY8vR4mYULF6pEiRJ5rufs2bMqW7asTp8+nedlcXsEQAAA7oK+ffvKYrHIYrHI3d1dVatW1YgRI3T16tVcl1u9erXGjx/v1Nr279+v//znP3rttddy7RccHKyEhATVrl3bod/ft2/fbO8SDggIUO/evTV27FiHfhduIAACAHCXtGvXTgkJCTpx4oQmTJig2bNna8SIETn2TU9PlySVKlVKvr6+Tq1r1qxZevrpp3P9nrS0NLm6uiooKEhubm5OreemF154QUuWLNGlS5fuyveZCQEQAIC7xNPTU0FBQQoODlaPHj3Us2dPrVmzRtKNN3c89NBDWrBggapWrSpPT08ZhpHtFHBqaqpGjhyp4OBgeXp6qnr16po/f751flRUlNq3b6/ixYsrMDBQvXv31vnz529ZU1ZWllasWKFOnTrZtFeuXFkTJkxQ37595e/vrwEDBuR4Cnjt2rWqXr26vL291aJFCy1atEgWi0V//vmnzfp+/PFH1apVS8WLF7cG4ZvbvWjRIn333XfWEdKIiAhJUlhYmIKCgvTtt9/e2Q7HLREAAQBFm2FIaVcL5mMY+Srd29vbOtInSX/88YeWL1+uVatW3fI6u+eff17Lli3Tp59+qkOHDmnu3LkqXry4JCkhIUHNmjXTQw89pF27dmn9+vU6c+aMnnnmmVvWsH//fv35559q0KBBtnkffvihateurd27d+udd97JNj8mJkbdunVTly5dtG/fPr300kt66623svVLSUnRtGnT9NVXX+mXX37RqVOnrCOfI0aM0DPPPGMNhQkJCXrkkUesyzZq1EibN2++Zf24M3dnDBcAAGdJT5EmlS+Y734zXvIodkeL7ty5U//n//wfPf7449a2tLQ0ffXVVypbtmyOyxw9elTLly9XeHi4WrVqJUmqWrWqdf6cOXNUr149m5s5FixYoODgYB09elT3339/tnXGxMTI1dVVAQEB2ea1bNnS5hR1TEyMzfy5c+eqRo0a+vDDDyVJNWrU0O+//66JEyfa9EtPT9fcuXN13333SZIGDRqk999/X5JUvHhxeXt7KzU1VUFBQdlqqFChgvbu3Zvj/sCdIwACAHCX/PDDDypevLgyMjKUnp6uzp07a+bMmdb5ISEhtwx/krRv3z65urqqWbNmOc7fvXu3fv75Z+uI4F8dP348xwB47do1eXp6ymKxZJuX06jgXx05ckQNGza0aWvUqFG2fj4+PtbwJ0nlypXT2bNnc133Td7e3kpJSbGrL+xXZALg7Nmz9eGHHyohIUEPPPCAZsyYoaZNm96y/6ZNmzR8+HAdPHhQ5cuX18iRI/Xyyy/n2HfZsmXq3r27OnfubL0WAwBQRLj73BiJK6jvzoMWLVpozpw5cnd3V/ny5eXu7m4zv1ix3EcTvb29c52flZWljh076oMPPsg2r1y5cjkuU6ZMGaWkpCgtLU0eHh55qscwjGzB0cjhtPjft9NiseTYLycXL17MNRTfTfdSFikS1wB+8803Gjp0qN566y3t3btXTZs21RNPPKFTp07l2D86Olrt27dX06ZNtXfvXr355psaPHiwVq1ala3vyZMnNWLEiFz/AwIACjGL5cZp2IL45DBqlptixYqpWrVqCgkJyRaK7BEWFqasrCxt2rQpx/n16tXTwYMHVblyZVWrVs3mc6sw99BDD0m6cfNIXtWsWVO//vqrTduuXbvyvB4PDw9lZmbmOO/3339X3bp187xOR7vXskiRCIAff/yx+vfvrxdffFG1atXSjBkzFBwcrDlz5uTYf+7cuapUqZJmzJihWrVq6cUXX1S/fv00bdo0m36ZmZnq2bOn3nvvPZtrKAAAKIwqV66sPn36qF+/flqzZo2io6MVERGh5cuXS5L+9a9/6eLFi+revbt27typEydOaMOGDerXr98tA1bZsmVVr149bdmyJc/1vPTSSzp8+LBGjRplvT5x4cKFkpTjKeXctmv//v06cuSIzp8/b70xJiUlRbt371abNm3yXJuj3WtZpNAHwLS0tBz/47dp00bbtm3LcZnIyMhs/du2batdu3bZ3G31/vvvq2zZsurfv79dtaSmpiopKcn6SU5OzuPWAACQP3PmzFG3bt306quvqmbNmhowYID1YdLly5fX1q1blZmZqbZt26p27doaMmSI/P395eJy60P+wIEDtWTJkjzXUqVKFa1cuVKrV69WnTp1NGfOHOtdwJ6ennavZ8CAAapRo4YaNGigsmXLauvWrZKk7777TpUqVXLayFhycrLNcT01NTXHfoUpiziMUcidPn3akGRs3brVpn3ixInG/fffn+My1atXNyZOnGjTtnXrVkOSER8fbxiGYWzZssWoUKGCce7cOcMwDKNPnz5G586dc61l7NixhqRsn9jY2DvdPABAHl27ds2Iiooyrl27VtCl3DOuXbtmVKpUydi2bVu+1zVhwgSjYsWKDqjKMBo2bGgsWbLkjpbN7XcSGxub4/F87NixOa6rMGURRykyN4HkdJFpbsPLt7oo1WKxKDk5Wb169dK8efNUpkwZu2sYM2aMhg8fbp0+ffq0QkND7V4eAIDCyMvLS4sXL871gdG3Mnv2bDVs2FClS5fW1q1b9eGHH2rQoEH5runs2bPq1q2bunfvnu913UpUVJQqVKhgnb7dqGVhyCKOUugDYJkyZeTq6qrExESb9rNnzyowMDDHZYKCgnLs7+bmptKlS+vgwYOKiYlRx44drfOzsrIkSW5ubjpy5IjN7eo3eXp62vw4kpKS7ni7AAAoTG71aJnbOXbsmCZMmKCLFy+qUqVKev311zVmzJh81xMQEKCRI0fmez258fX1lZ+f3237FaYs4iiFPgB6eHiofv36Cg8PV9euXa3t4eHh6ty5c47LNGnSRN9//71N24YNG9SgQQO5u7urZs2aOnDggM38t99+W8nJyfrkk08UHBzs+A0BAOAeNH36dE2fPr2gy3CqezGLFPoAKEnDhw9X79691aBBAzVp0kRffPGFTp06ZX2WzpgxY3T69GktXrxYkvTyyy9r1qxZGj58uAYMGKDIyEjNnz9fS5culXRjqLt27do231GiRAlJytYOAABwr2WRIhEAn332WV24cEHvv/++EhISVLt2ba1bt04hISGSbrz78K/P4alSpYrWrVunYcOG6bPPPlP58uX16aef6qmnniqoTQAAAEXYvZZFLIaRzzdZm1hcXJyCg4MVGxurihUrFnQ5AGAK169fV3R0tCpXrnzbN2PAvK5du6aYmBhVqVJFXl5eNvM4fheB5wACAPBXN9+gwfthkZubv487eeOKGRSJU8AAANzk6uqqEiVK6OzZs5IkHx+fPL11Avc2wzCUkpKis2fPqkSJEnJ1dS3okgolAiAAoMgJCgqSJGsIBP6uRIkS1t8JsiMAAgCKHIvFonLlyikgIMDmtVqAdOO0LyN/uSMAAgCKLFdXVw70wB3gJhAAAACTIQACAACYDAEQAADAZAiAAAAAJkMABAAAMBkCIAAAgMkQAAEAAEyGAAgAAGAyBEAAAACTIQACAACYDAEQAADAZAiAAAAAJkMABAAAMBkCIAAAgMkQAAEAAEyGAAgAAGAyBEAAAACTIQACAACYDAEQAADAZAiAAAAAJkMABAAAMBkCIAAAgMkQAAEAAEyGAAgAAGAyBEAAAACTIQACAACYDAEQAADAZAiAAAAAJkMABAAAMBkCIAAAgMkQAAEAAEyGAAgAAGAyBEAAAACTuaMAeP36dUfXAQAAgLvE7gCYlZWl8ePHq0KFCipevLhOnDghSXrnnXc0f/58pxUIAAAAx7I7AE6YMEELFy7U1KlT5eHhYW0PCwvTl19+6ZTiAAAA4Hh2B8DFixfriy++UM+ePeXq6mptr1Onjg4fPuyU4gAAAOB4dgfA06dPq1q1atnas7KylJ6e7tCiAAAA4Dx2B8AHHnhAmzdvzta+YsUK1a1b16FFAQAAwHnc7O04duxY9e7dW6dPn1ZWVpZWr16tI0eOaPHixfrhhx+cWSMAAAAcyO4RwI4dO+qbb77RunXrZLFY9O677+rQoUP6/vvv1bp1a2fWCAAAAAeyawQwIyNDEydOVL9+/bRp0yZn1wQAAAAnsmsE0M3NTR9++KEyMzOdXQ8AAACczO5TwK1atVJERIQTS8nd7NmzVaVKFXl5eal+/fo53pDyV5s2bVL9+vXl5eWlqlWrau7cuTbz582bp6ZNm6pkyZIqWbKkWrVqpZ07dzpzEwAAQBF2L2URuwPgE088oTFjxmjEiBFaunSp1q5da/Nxpm+++UZDhw7VW2+9pb1796pp06Z64okndOrUqRz7R0dHq3379mratKn27t2rN998U4MHD9aqVausfSIiItS9e3f9/PPPioyMVKVKldSmTRudPn3aqdsCAACKnnsuixh2slgst/y4uLjYu5o70qhRI+Pll1+2aatZs6YxevToHPuPHDnSqFmzpk3bSy+9ZDz88MO3/I6MjAzD19fXWLRokd11xcbGGpKM2NhYu5cBAAAF606O34U1i9ypPL0L+FYfZ14bmJaWpt27d6tNmzY27W3atNG2bdtyXCYyMjJb/7Zt22rXrl23fGh1SkqK0tPTVapUqVvWkpqaqqSkJOsnOTk5j1sDAAAKi+TkZJvjempqao79ClMWcRS7A2BBOX/+vDIzMxUYGGjTHhgYqMTExByXSUxMzLF/RkaGzp8/n+Myo0ePVoUKFdSqVatb1jJ58mT5+/tbP6GhoXncGgAAUFiEhobaHNcnT56cY7/ClEUcxe4HQb///vu5zn/33XfzXUxuLBaLzbRhGNnabtc/p3ZJmjp1qpYuXaqIiAh5eXndcp1jxozR8OHDrdOnT58mBAIAUERFRUWpQoUK1mlPT89c+xeGLOIodgfAb7/91mY6PT1d0dHRcnNz03333ee0AFimTBm5urpmS9hnz57NlqxvCgoKyrG/m5ubSpcubdM+bdo0TZo0Sf/73/9Up06dXGvx9PS0+XEkJSXlZVMAAEAh4uvrKz8/v9v2K0xZxFHsPgW8d+9em8/vv/+uhIQEPf744xo2bJjTCvTw8FD9+vUVHh5u0x4eHq5HHnkkx2WaNGmSrf+GDRvUoEEDubu7W9s+/PBDjR8/XuvXr1eDBg0cXzwAACjy7skskt+7SA4cOGCEhITkdzW5WrZsmeHu7m7Mnz/fiIqKMoYOHWoUK1bMiImJMQzDMEaPHm307t3b2v/EiROGj4+PMWzYMCMqKsqYP3++4e7ubqxcudLa54MPPjA8PDyMlStXGgkJCdZPcnKy3XVxFzAAAEXPnRy/C2sWuVP5DoCbN282SpQo4YhacvXZZ58ZISEhhoeHh1GvXj1j06ZN1nl9+vQxmjVrZtM/IiLCqFu3ruHh4WFUrlzZmDNnjs38kJAQQ1K2z9ixY+2uiQAIAEDRc6fH78KYRe6UxTD+3xWJt/Hpp5/+feRQCQkJ+uqrr/TYY49p6dKlDhqTLDri4uIUHBys2NhYVaxYsaDLAQAAduD4nYebQKZPn24z7eLiorJly6pPnz4aM2aMwwsDAACAc9gdAKOjo51ZBwAAAO4Su+8C7tevX45vvrh69ar69evn0KIAAADgOOvXr9eWLVus03YHwEWLFunatWvZ2q9du6bFixc7pjoAAAA43BtvvGF9fvGBAwdufwo4KSlJxo27hZWcnGzzdOrMzEytW7dOAQEBzqsYAAAA+RIdHW19e9mqVatuHwBLlCghi8Uii8Wi+++/P9t8i8Wi9957z/GVAgAAwCE8PDyUkpIiSfrf//53+wD4888/yzAMtWzZUqtWrVKpUqVsVhYSEqLy5cs7r2IAAADkyz/+8Q8NHz5cjz76qHbu3Hn7ANisWTNJN4YOg4OD5eJi92WDAAAAKARmzZqlV199VStXrtScOXPsfwxMSEiIJCklJUWnTp1SWlqazfy79fJiAAAA5E2lSpX0ww8/WKftDoDnzp3TCy+8oP/+9785zs/MzMx/dQAAAHCK48eP69///reOHz9u/2Nghg4dqkuXLmn79u3y9vbW+vXrtWjRIlWvXl1r1651Zr0AAADIh02bNiksLEw7duzQ6tWr7R8B3Lhxo7777js1bNhQLi4uCgkJUevWreXn56fJkyerQ4cOzqwbAAAAd2j06NGaMGGChg8fLl9fX/tHAK9evWp93l+pUqV07tw5SVJYWJj27NnjnGoBAACQbwcOHFDXrl2t03YHwBo1aujIkSOSpIceekiff/65Tp8+rblz56pcuXKOrxQAAAAOUaJECSUkJFin7T4FPHToUOuCY8eOVdu2bbVkyRJ5eHho4cKFDi8UAAAAjtGjRw+NGjVKK1askMVisT8A9uzZ0/p33bp1FRMTo8OHD6tSpUoqU6aMU4oFAABA/k2cOFF9+/ZVhQoVZBiGfaeA09PTVbVqVUVFRVnbfHx8VK9ePcIfAABAIefu7q4lS5bo2LFjWr58uX0jgO7u7kpNTZXFYnF2fQAAAHCSqlWrqmrVqvbfBPLaa6/pgw8+UEZGhjPrAgAAgIN169ZNU6ZMsU7bfQ3gjh079NNPP2nDhg0KCwtTsWLFbOavXr3acVUCAADAYTZt2qSxY8dap+0OgCVKlNBTTz3llKIAAADgPFeuXJGHh4d12u4A+O9//9spBQEAAMC5ateurW+++UbvvvuupDwEQEnKyMhQRESEjh8/rh49esjX11fx8fHy8/NT8eLFnVIwAAAA8uedd97RU089pePHj6tly5b2B8CTJ0+qXbt2OnXqlFJTU9W6dWv5+vpq6tSpun79uubOnevMugEAAHCHOnXqpDVr1mjSpElauXKl/XcBDxkyRA0aNNClS5fk7e1tbe/atat++uknpxQLAAAAx+jQoYO2bt2qq1ev2j8CuGXLFm3dutXmAkJJCgkJ0enTpx1eJAAAAJzD7gCYlZWlzMzMbO1xcXHy9fV1aFEAAADIn1KlSuno0aMqU6aMSpYsafNCD7sDYOvWrTVjxgx98cUXkiSLxaIrV65o7Nixat++veOrBgAAwB2bPn26dZBuxowZNvPsDoDTp09XixYtFBoaquvXr6tHjx46duyYypQpo6VLlzq2YgAAAORLnz59JMn6Fre2bdsqKChIUh4CYPny5bVv3z4tXbpUe/bsUVZWlvr376+ePXva3BQCAACAwsPNzU2vvPKKDh069P/b8rICb29v9evXT/369XN4cQAAAHCOxo0ba+/evQoJCZGUxwB45MgRzZw5U4cOHZLFYlHNmjU1aNAg1axZ0ynFAgAAIP9effVVvf7664qLi1P9+vXtfw7gypUrVbt2be3evVsPPvig6tSpoz179igsLEwrVqxwZs0AAADIh2effVbR0dEaPHiwHn30UftHAEeOHKkxY8bo/ffft2kfO3asRo0apaefftrhxQIAACD/oqOjbabtHgFMTEzU888/n629V69eSkxMzH9lAAAAcLjk5GQdPXpUBw8eVFZ/SjYAACAASURBVLFixRQSEmL/CGDz5s21efNmVatWzaZ9y5Ytatq0qcOLBQAAQP7s379fTzzxhBITE2UYhvz8/LRy5Ur7A2CnTp00atQo7d69Ww8//LAkafv27VqxYoXee+89rV271qYvAAAACtbo0aNVqVIlrVixQl5eXnrvvfc0aNAgWQzDMOxZgYuLfWeLLRZLjq+MuxfFxcUpODhYsbGxqlixYkGXAwAA7GCm43dAQIDWrVunBg0aSJIuXLiggICAvL0LGAAAAEXH+fPnValSJet06dKl5ePjk7fnAAIAAKDosFgsSk5OlpeXlyTJMAxZLJa8BcCdO3cqIiJCZ8+ezTYi+PHHHzuuWgAAAOSbYRi6//77s7XZHQAnTZqkt99+WzVq1FBgYKAsFot13l//BgAAQOHw888/59hudwD85JNPtGDBAvXt29dRNQEAAMCJmjVrlmO73Q+CdnFx0aOPPuqwggAAAFAw7A6Aw4YN02effebMWgAAAHAX2H0KeMSIEerQoYPuu+8+hYaGyt3d3Wb+6tWrHV4cAAAAHM/uAPjaa6/p559/VosWLVS6dGlu/AAAACii7A6Aixcv1qpVq9ShQwdn1gMAAAAniouLs/8awFKlSum+++5zZj25mj17tqpUqSIvLy/Vr19fmzdvzrX/pk2bVL9+fXl5ealq1aqaO3dutj6rVq1SaGioPD09FRoaqm+//dZZ5QMAgCKuKGeRrKwsvf/++/L391dISIhk2GnBggXGM888Y1y9etXeRRxm2bJlhru7uzFv3jwjKirKGDJkiFGsWDHj5MmTOfY/ceKE4ePjYwwZMsSIiooy5s2bZ7i7uxsrV6609tm2bZvh6upqTJo0yTh06JAxadIk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IlIZBkAiIiIilWEAJCIiIlIZBkAismspKSnQaDTQaDR46KGH4OXlhdmzZ2Pv3r0wm83D/j35+fkYPXr0A6yUiMhyGACJyO7p9Xp0dHSgtbUVJSUliIqKwrJlyxAbGwuj0Wjt8oiILI4BkIjsnqOjI8aMGYNx48ZhypQpWLlyJQwGA0pKSpCfnw8A2LJlC4KDg+Hi4gJvb28sXboUPT09AICTJ09i0aJFuH79unI2MSsrCwDQ39+PjIwMjBs3Di4uLoiIiMDJkyetM1EiomFiACQiVYqOjkZoaCgOHToEANBqtcjJyUF9fT2++OILlJeXIyMjAwAQGRmJ7OxsuLm5oaOjAx0dHVi+fDkAYNGiRaisrERBQQFqa2vx8ssvQ6/Xo6WlxWpzIyL6fzQiItYugojoQUlJSUF3dzcKCwtv2fbqq6+itrYWjY2Nt2zbv38/lixZgq6uLgAD9wCmp6eju7tb2efChQsICAjA5cuXMXbsWGV81qxZePrpp7F+/foHMCMionvnYO0CiIisRUSg0WgAACdOnMD69evR2NiI3377DUajEb29vbhx4wZcXFxue/zZs2chIggMDBwy3tfXBw8PjwdePxHRv8UASESq1dTUBF9fX7S1tSEmJgZpaWn46KOP4O7ujoqKCqSmpuLmzZt3PN5sNkOn0+Hnn3+GTqcbss3V1fVBl09E9K8xABKRKpWXl6Ourg7vvPMOqqqqYDQasXnzZmi1A7dGf/PNN0P2HzVqFEwm05Cx8PBwmEwmXLlyBTNnzrRY7URE94oBkIjsXl9fHzo7O2EymfDrr7+itLQUGzZsQGxsLJKTk1FXVwej0Yht27YhLi4OlZWV2Llz55DfMX78ePT09OD48eMIDQ2Fs7MzAgMDsWDBAiQnJ2Pz5s0IDw9HV1cXysvLERwcjJiYGCvNmIjo7rgKmIjsXmlpKR5//HGMHz8eer0eJ06cQE5ODgwGA3Q6HcLCwrBlyxZs3LgRkydPxldffYUNGzYM+R2RkZFIS0tDYmIiPD098emnnwIA8vLykJycjHfffRdBQUGIj4/H6dOn4e3tbY2pEhENC1cBExEREakMzwASERERqQwDIBEREZHKMAASERERqQwDIBEREZHKMAASERERqQwDIBEREZHKMAASERERqQwDIBEREZHKMAASERERqQwDIBEREZHKMAASERERqQwDIBEREZHKMAASERERqQwDIBEREZHKMAASERERqQwDIBEREZHKMAASERERqQwDIBEREZHKMAASERERqQwDIBEREZHKMAASERERqQwDIBEREZHKMAASERERqQwDIBEREZHKMAASERERqQwDIBEREZHKMAASERERqQwDIBEREZHKMAASERERqQwDIBEREZHKMAASERERqQwDIBEREZHKMAASERERqQwDIBEREZHKMAASERERqcx/AHEyNGemnHbBAAAAAElFTkSuQmCC"

   
    average_weather=pd.read_csv(path.join(path.dirname(__file__),'static/data/average_weather.csv'))

    avocado_prices = pd.read_csv(path.join(path.dirname(__file__), 'static/data/avocado_prices.csv'))

    l = list(set(avocado_prices["Region"]))
    l.sort()
    m = list(zip(l, l))
    form.state.choices = m

    if request.method == 'POST':

        # Variables
        state = form.state.data
        startDate = form.startDate.data
        endDate = form.endDate.data

        # Analysis
        average_weather["Date"] = pd.to_datetime(average_weather["Date"])
        average_weather = average_weather.set_index("State")
        average_weather = average_weather.loc[[state]]
        average_weather = average_weather.set_index("Date")
        average_weather = average_weather.sort_index()
        average_weather = average_weather.groupby("Date").mean()
        average_weather["Temperature"] = average_weather["Temperature"].astype(int)
        startDate = pd.Timestamp(startDate)
        endDate = pd.Timestamp(endDate)
        average_weather_results = average_weather[startDate:endDate]
        avocado_prices["Date"] = pd.to_datetime(avocado_prices["Date"])
        avocado_prices = avocado_prices.drop(columns="Volume")
        avocado_prices = avocado_prices.set_index("Region")
        avocado_prices = avocado_prices.loc[[state]]
        avocado_prices = avocado_prices.set_index("Date")
        avocado_prices = avocado_prices.groupby("Date").mean()
        avocado_prices = avocado_prices.sort_index()
        avocado_prices_results = avocado_prices[startDate:endDate]
        fig = plt.figure()
        ax = fig.add_subplot()
        average_weather_results["Temperature"].plot(legend = True, ax = ax)
        avocado_prices_results["Price"].plot(secondary_y = True, legend = True, ax = ax)
        ax.set_ylabel("Average Temperature")
        ax.right_ax.set_ylabel("Avocado Prices")

        # Conversion
        chart = plotToImage(fig)
    
    return render_template(
        'query.html',
        form = form,
        chart = chart,
        title='Query',
        year=datetime.now().year
    )

# Account


@app.route('/login', methods=['GET', 'POST'])
def login():
    form = LoginFormStructure(request.form)

    if request.method == 'POST' and form.validate():
        if (db_Functions.IsLoginGood(form.username.data, form.password.data)):
            return redirect('/query')
        else:
            flash('Incorrect cerdentials!')
   
    return render_template(
        'login.html',
        form=form, 
        title='Login',
        year=datetime.now().year
    )


@app.route('/register', methods=['GET', 'POST'])
def register():
    form = RegisterFormStructure(request.form)

    if (request.method == 'POST' and form.validate()):
        if (not db_Functions.IsUserExist(form.username.data)):
            db_Functions.AddNewUser(form)
            db_table = ""
            return redirect('/login')
        else:
            flash('User already exists!')
            form = RegisterFormStructure(request.form)
    return render_template(
        'register.html',
        form=form,
        title='Register',
        year=datetime.now().year
    )


def plotToImage(fig):
    pngImage = io.BytesIO()
    FigureCanvas(fig).print_png(pngImage)
    pngImageB64String = "data:image/png;base64,"
    pngImageB64String += base64.b64encode(pngImage.getvalue()).decode('utf8')
    return pngImageB64String